---
title: "Final Project"
author: "Sarah Lass"
date: "May 18, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Intro

#### Background

Wine vineyards cover 7,600k hectare of the worlds surface area. In just the US from 2009 until 2018, the number of wineries has increased from 6357 to 9654. The US is also the leading global consumer of wine. And on top of that, 5% of Amerians drink wine daily (https://www.statista.com/topics/1541/wine-market/). Wine is a very popular drink of choice and people want to drink wine that tastes good.

#### Quesiton 

So, what characteristic when making wine give it a better taste? There are so many companies that make wine all over the world and they want people to enjoy and buy their products.  Data was collected for white wine in 2009 about different physicochemical tests, like the pH level or the acidity level, to determine the quality of the wine based on median score given by three wine experts after tasting each sample (http://archive.ics.uci.edu/ml/datasets/Wine+Quality). This data is relevant becuase over the years the number of gallons of wine consumed per person per year in the US alone has increased by a half gallon from 2009 at 2.51 gallon to 2016 at 2.94 gallons (https://www.wineinstitute.org/resources/statistics/article86). This shows a growing industry where companies are going to want to make better quality wine to stand out in the competitive market. This also connects to data science becuase it can help businesses address the question of what characteristics of wine make for a better quality.

#### Audience

While this may not be in the interest of the average person, it would be in the interest of companies that produce wine, or even wine critiques like the ones that graded the wines in this dataset. Companies and other wine enthusiasts would be interested in knowing how different make-ups of wines rate based on taste. This could help them determine how their wines would compare to others and see how to make better quality wine. 


## Data Description

In this dataset, there are 11 input variables with 1 response variable. The input variables (based on physicochemical tests) are fixed acidity, volatile acidity, citric acid, residual sugar, chlorides, free sulfur dioxide, total sulfur dioxide, density, pH, sulphates, and alcohol.  The output variable (based on sensory data) is quality desribed as a score between 0 and 10. Each of the variables are continuous numeric variables because they are all real numbers.

## Getting the Data
The data listed on the UCI Machine Learning Repository is given in a cvs file. This makes it easier to import into R. However, the data is given in one single column with each attribute separated by a semicolon, which is not a helpful way of organizing the data to make is easy to manipulate.

```{r}
library(readr)

dataset <- read_csv("C:/Users/slass/Downloads/winequality-white.csv")

head(dataset)
```

To fix this issue, the column name of the data frames needs to be changed first so that any other cleaning can happen. Here the column name is changed to values as a temporary column name. Next, the rows can be separated with the separate function under the tidyr package (https://www.rdocumentation.org/packages/tidyr/versions/0.8.0/topics/separate). This function takes the data frame, called dataset, and the column that needs to be separated, called values, and separates the row by the regular expression or number given, in this case by a ";". The types of the columns also needs to be converted to that they are not type character but the actual type, like double or int. This argument is called convert and it is set to true. A plus about this data set is that all the observations are complete, meaing that there is no missing data, so there is no need to worry about removing or dealing with incompelete rows. If there were, we would need to decide whether or not to keep the observations with data or change them to make them easier to work with.

```{r}
library(tidyr)

colnames(dataset) <- "values"

wine <- separate(dataset, values, c("fixed_acidity","volatile_acidity","citric_acid","residual_sugar","chlorides","free_sulfur_dioxide","total_sulfur_dioxide","density","pH","sulphates","alcohol","quality"), sep = ";", convert = TRUE)
head(wine)


```

For future use of the data, we will add an additional column that makes the response variable into a categorical variable. We will change the variable to be 5 or less to be poor quality and 6 or greater to be good quality. Good quality will be classifyied as 1 or success and poor quality will be 0. After changing the response variable to a categorical classifier, the old response variable is removed. If we need to access the old response variable, we are able to just use the old data frame. Therefore, wine is a numeric response and wineClass is a categorcal response.

```{r}
library(dplyr)
good <- c("6", "7", "8", "9", "10")
poor <- c("0", "1", "2", "3", "4", "5")

wineClass <- wine %>%
  mutate(qualitySuc = ifelse(quality %in% good, 1, 0))
wineClass <- wineClass[,-12]
head(wineClass)
```

## Data Exploration

#### Summary Statistics 

The next step for any data set is to preform some preliminary data exploration. For more information about data exploration and getting started, visit https://www.analyticsvidhya.com/blog/2016/01/guide-data-exploration/. First we are going to look at the distribution of the response variable, quality.

```{r}
library(ggplot2)

wine %>%
  ggplot(aes(x=quality)) + geom_histogram(bins = 15) + geom_vline(aes(xintercept=median(quality)), color="red")

wine %>%
  summarize(mean = mean(quality), median = median(quality))
```

We can see that the spread of the data is centered around a quality of 6 and that the shape is similar to a bell curve. The median value itself is 6 as shown by the vertical red line. The mean of the response variable however is 5.8 which is slightly lower than the median. This means that the average grade given for a wine is 5.8 which is in the poor category.

Lets now found out the standard deviation of the response variable.

```{r}
wine %>%
  summarize(sd = sd(quality), iqr = IQR(quality))
```

The standard deviation .8856 which means that 5.8 + .88 is one standard deviation above the mean and 5.8 - .88 is one standard deviation below the mean. Therefore, 95 percent of the data is between 6.68 and 4.92.

#### Visualization 

Next, it is important to perform exploratory data analysis on the data to get a better understanding of how to variables interact with one another and the response variable. To see how each variable intereacts with each other, the function pairs() is used.  This function makes a scatterplot matrix of all the variables. After looking at each of the combinations, the ones that looked to have a linear relationship are made bigger into a plot of their own. The relationship between free sulfer sioxide and total sulfer dioxide can be expected however becuase free sulfer dioxide is a proportion of the total sulfer dioxide. The other two graphs, residual v density and alcohol v density, may have interactions that can be examined later on.

```{r}
library(dplyr)
library(tibble)
library(ggplot2)

pairs(wineClass)

wineClass %>%
  #sample_frac(.1) %>%
  ggplot(aes(x=free_sulfur_dioxide, y=total_sulfur_dioxide)) +
    geom_point() 

wineClass %>%
  #sample_frac(.1) %>%
  ggplot(aes(x=residual_sugar, y=density)) +
    geom_point()  

wineClass %>%
  #sample_frac(.1) %>%
  ggplot(aes(x=alcohol, y=density)) +
    geom_point()  

```

## Hypothesis Testing and Machine Learning

#### Models

We are going to determine the best way to to rate wine based on the given variables.  To do this we must first fit a linear regression model and conduct some hypothesis testing to fit out which of the variables are actually significant in determining the response. For more help to fit a linear model check out http://stat.ethz.ch/R-manual/R-devel/library/stats/html/lm.html.

```{r}
library(standardize)
#wine_sd <- standardize(wine)
# standardize(quality~fixed_acidity+volatile_acidity+citric_acid+residual_sugar+chlorides+free_sulfur_dioxide+total_sulfur_dioxide+density+pH+sulphates+alcohol, data = wine)
mlr <- lm(quality~., data = wine)
summary(mlr)
anova(mlr)
plot(mlr)
```

After fitting the multiple linear regression model, we can come up with a base model equation:
quality = 150.5 + .0065 fixed_acidity - 1.863 volitile_acidity + .0209 citric_acidity + .08148 residual_sugar - .2473 chlorides + .003733 free_sulfur_dioxide - .0002857 total_sulfur_dioxide - 150.3 density + .6863 pH + .6315 sulphates + .1935 alcohol

To test if the variables are significant or not, we do a hypothesis test on each variable at a 5% significance level. The null hypothesis is beta equals zero with the alternative beta different from zero. We use the t test to determine this. The t statistic is found by the following formula: b/Se which is the estimate divied by the standard error. A table would then be used to find the p-val to conculde the hypothesis test but the output already lists it. We can see that all the variables are significant at the 5% level except total_sulfur_dioxide, chlorides, and citric_acid meaing that we reject the null for each variable except the listed variables.

However, the model is only able explain 28% of the data as shown by the R^2 value. Also, the assumption plots do not look at all as they should. Residuals v Fitted values should have equal spread across the plot, but it has a linear pattern that repeats. Lets try to see what happens to the modle after the insignificant variables are removed.

```{r}
mlr <- lm(quality~fixed_acidity+volatile_acidity+residual_sugar+free_sulfur_dioxide+density+pH+sulphates+alcohol, data = wine)
summary(mlr)
anova(mlr)
plot(mlr)
```

All the variables are still significant and the adjusted R-squared value did increase meaning that this change did help the model, but only very slightly. Also, the assumpotion plots look no better than they did before. Because of the patterns in the assumption plots, we can try logistic regresstion to try to make it better. For help to fit a logistic model, check out https://www.r-bloggers.com/how-to-perform-a-logistic-regression-in-r/.

Next, we will try interactions between the variables that we found had linear relationships in the data exploration part.

```{r}
mlr <- lm(quality~fixed_acidity*density+volatile_acidity+residual_sugar*density+free_sulfur_dioxide+pH+sulphates+alcohol, data = wine)
summary(mlr)
anova(mlr)
plot(mlr)
```

From this we can see all the variables are still significant but the assumption plots are still not met.

Another idea to try to model the data is a logistical regession model. A regression model needs the response variable to be categorical so we use the wineClass data frame here.

```{r}
grm  <- glm(qualitySuc~., data = wineClass, family = binomial())
summary(grm)
anova(grm)
plot(grm)
```

With this model, we can see that again some variables fail to reject the null hypothesis at the 5% level. Those variables are total_sulfur_dioxide, chlorides, citric_acid, and fixed_acidity. These are the same variabe plus one more that are not significant so we will fit the model again without these variables.

```{r}
grm  <- glm(qualitySuc~volatile_acidity+residual_sugar+free_sulfur_dioxide+density+pH+sulphates+alcohol, data = wineClass, family = binomial())
summary(grm)
anova(grm)
plot(grm)
```

This helps the assumption plots a little, but they are still not very good. 

## Conclusion

Overall, we can see that it is very hard to predict how someone will rate each wine because it is based on individual taste preferences.  

